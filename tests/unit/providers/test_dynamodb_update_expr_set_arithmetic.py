"""Tests for DynamoDB UpdateExpression evaluator (P1-24)."""

from __future__ import annotations

from ldk.providers.dynamodb.update_expression import (
    apply_update_expression,
)

# ---------------------------------------------------------------------------
# SET: regular assignment
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# SET: if_not_exists
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# SET: list_append
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# SET: arithmetic
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# REMOVE
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# ADD
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# DELETE (from set)
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# Combined clauses
# ---------------------------------------------------------------------------


# ---------------------------------------------------------------------------
# Parser tests
# ---------------------------------------------------------------------------


class TestSetArithmetic:
    """Test SET with arithmetic (+, -)."""

    def test_add_to_number(self) -> None:
        item = {"pk": "1", "count": 10}
        result = apply_update_expression(
            item,
            "SET count = count + :inc",
            expression_values={":inc": {"N": "5"}},
        )
        assert result["count"] == 15

    def test_subtract_from_number(self) -> None:
        item = {"pk": "1", "count": 10}
        result = apply_update_expression(
            item,
            "SET count = count - :dec",
            expression_values={":dec": {"N": "3"}},
        )
        assert result["count"] == 7

    def test_add_with_value_refs(self) -> None:
        item = {"pk": "1", "price": 100}
        result = apply_update_expression(
            item,
            "SET price = price + :tax",
            expression_values={":tax": {"N": "15"}},
        )
        assert result["price"] == 115
